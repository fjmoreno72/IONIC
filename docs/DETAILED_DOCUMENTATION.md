# IOCore2 Coverage Analysis Tool - Detailed Documentation

This document provides a detailed summary of the various files within the IOCore2 Coverage Analysis Tool project.

## Python Files (`.py`)

*   **`run.py`**: This script is the main entry point for starting the Flask web application. It imports the application factory (`create_app`) and configuration, sets up logging, retrieves environment variables for host, port, and debug mode, and then launches the Flask development server using `app.run()`. It also includes logic to suppress SSL warnings if verification is disabled.
*   **`app/__init__.py`**: This file contains the Flask application factory (`create_app`). It initializes the Flask app, configures settings (like secret key, debug mode, session type), sets up logging, registers custom error handlers (for 404, 500, and application-specific `IOnic2Error`), registers the different route blueprints (auth, api, views, config_items), adds a route for `favicon.ico`, and includes an `after_request` hook to add security headers (like Permissions-Policy, X-Content-Type-Options, X-Frame-Options, Referrer-Policy) to every response.
*   **`app/api/__init__.py`**: An empty file that designates the `app/api` directory as a Python package, allowing modules within it to be imported.
*   **`app/api/client.py`**: Defines a reusable `ApiClient` class built on the `requests` library. This class serves as a base for making HTTP requests to external APIs. It handles session management, base URL configuration, request timeouts, SSL certificate verification (supporting both standard verification and custom CA bundles), and cookie management. It provides standardized methods for making `GET` and `POST` requests, including robust error handling for network issues, timeouts, non-2xx status codes (raising `ApiRequestError`), and potential session invalidation (raising `InvalidSession`). It also features a method (`stream_response`) for handling large, streamed responses with progress logging and stall detection.
*   **`app/api/iocore2.py`**: This file defines the `IOCore2ApiClient` class, which inherits from the base `ApiClient`. It implements methods specific to interacting with the IOCore2 API endpoints. Key methods include: `login` (handles authentication by fetching the login page, extracting a verification token using BeautifulSoup, and submitting credentials), `get_ier_coverage`, `get_requirement_coverage`, `get_test_cases`, `get_test_results`, `get_patterns`, `get_actors` (retrieve respective data sets, parse JSON, optionally save to files), and `get_system_health` (fetches system health status). Methods fetching large datasets use streaming and can optionally save processed Markdown reports.
*   **`app/config/__init__.py`**: An empty file that designates the `app/config` directory as a Python package.
*   **`app/config/settings.py`**: This module centralizes configuration settings for the application. It defines base paths (like the project root and data directory), ensures the data directory exists, and retrieves settings from environment variables with sensible defaults. Key settings include the Flask `APP_SECRET_KEY`, the `DEFAULT_URL` for the IOCore2 API, `DEBUG` mode status, logging configurations (`LOG_FILE`, `LOG_FORMAT`, `LOG_LEVEL`), and API request parameters like `REQUEST_TIMEOUT`, `VERIFY_SSL` (controlling SSL certificate validation), and an optional `CUSTOM_CA_BUNDLE` path.
*   **`app/core/__init__.py`**: An empty file that designates the `app/core` directory as a Python package.
*   **`app/core/auth.py`**: This module handles user authentication and session management. It provides: `@login_required` decorator (checks session, redirects/returns 401), `authenticate_user` function (calls API client login, returns success/failure and cookies), and `get_api_client` helper (creates authenticated `IOCore2ApiClient` from session data).
*   **`app/core/exceptions.py`**: Defines custom exception classes (`IOnic2Error`, `InvalidSession`, `ApiRequestError`, `DataFormatError`, `ResourceNotFoundError`, `ValidationError`) inheriting from a base class with status codes and a `to_dict` method for standardized JSON error responses. Includes `handle_exception` function used by Flask error handlers for consistent logging and response formatting.
*   **`app/data_models/__init__.py`**: An empty file that designates the `app/data_models` directory as a Python package.
*   **`app/data_models/ier_analysis.py`**: This module focuses on processing and analyzing Interface Exchange Requirements (IER) data. Includes functions to read TIN data from CSV, extract IDP numbers, filter TINs based on asterisk rules (`should_include_tin`), organize raw IER data hierarchically (PI -> IER -> Service Instruction -> Test Cases), and generate formatted Markdown reports from the hierarchy.
*   **`app/data_models/models.py`**: Defines Python `dataclass`es (`TestCase`, `SREQ`, `Function`, `EP`, `TIN`, `SI`, `IER`, `PI`, `CoverageData`) to model IOCore2 entities and their hierarchical relationships. Provides a structured representation for API data and includes `add_...` methods for building the hierarchy and merging data.
*   **`app/data_models/sreq_analysis.py`**: Provides functions for analyzing System Requirements (SREQ) data. Includes dataclasses for structuring analysis results. Key functions: `extract_null_testcase_entries` (filters SREQs without test cases), `organize_hierarchical_data` (structures null entries by SI -> TIN -> EP -> SREQ), `organize_functional_data` (groups all SREQs by SI -> Function using a mapping file), `organize_tin_data` (groups all SREQs by SI -> TIN), and `generate_markdown` (creates a report listing SREQs with null test cases).
*   **`app/routes/__init__.py`**: An empty file that designates the `app/routes` directory as a Python package.
*   **`app/routes/api.py`**: Defines a Flask Blueprint (`api_bp`) for API endpoints. Most require authentication. Provides routes for: triggering remote data fetches (IER, SREQ (background), Test Cases, Results, Patterns, Actors), checking SREQ background status, retrieving local data (processed SREQ/IER, actor names, raw files like actors/patterns/test cases, ASC data), saving patterns (POST), getting system metrics, and proxying remote system health. Manages an in-memory actor ID map.
*   **`app/routes/auth.py`**: Defines `auth_bp` Blueprint for authentication routes: `/login` (POST, authenticates via API, stores session cookies/URL), `/logout` (clears session), `/check_auth` (returns session authentication status).
*   **`app/routes/config_items.py`**: Defines `config_items_bp` Blueprint. Provides `/api/config-items` endpoint handling CRUD operations (GET, POST, PUT, DELETE) for ASC Configuration Items stored in `app/static/ASC/data/configItem.json`. Requires login.
*   **`app/routes/views.py`**: Defines `views_bp` Blueprint for rendering HTML pages. Includes routes for login (`/`), various tree views (SREQ by TIN, SREQ by Function, IER), system monitor, test cases page, and ASC module pages (Affiliates, Services, GPs, CIs, SPs, ASCs, Kanban). Also contains integrated API endpoints for ASC data management (update ASCs, upload icons/flags, SP/Affiliate CRUD). Most routes require login.
*   **`app/utils/__init__.py`**: An empty file that designates the `app/utils` directory as a Python package.
*   **`app/utils/file_operations.py`**: Provides reusable utility functions: `read_json_file` (reads/parses JSON, handles errors), `write_json_file` (writes Python object to JSON file with indentation, ensures directory exists), `write_markdown_file` (writes string content to a file, ensures directory exists).
*   **`app/utils/logging.py`**: Contains `configure_logging` function. Sets up application logging (root and Flask loggers) based on `settings.py`. Configures console and rotating file handlers with specified format and level.
*   **`app/utils/test_case_utils.py`**: Provides utilities for test case data processing. Includes `get_latest_version` (identifies the latest version of each test case by key, sorting by version number and date) and `_parse_date` helper (parses various date string formats).

## HTML Files (`.html`)

*   **`app/templates/index_ier_tree.html`**: Jinja2 template for the IER Hierarchy Viewer. Displays IERs grouped by PI -> IER -> TIN/Service Instruction -> Test Cases. Features coverage percentage indicators (with color coding), tooltips, search (IER, TCA), expand/collapse controls, and theme switching. Interactivity handled by `tree_ier.js`.
*   **`app/templates/index_ionic.html`**: Jinja2 template for the application Login Page. Displays logo, title, and login form (URL, Username, Password). Conditionally includes nav menu if logged in. JavaScript handles form submission via fetch API and redirects on success.
*   **`app/templates/index_tree_func.html`**: Jinja2 template for the SREQ Functional Hierarchy Viewer. Displays SREQs grouped by SI -> Function -> SREQ -> Test Case -> Actor. Features coverage indicators, multi-field search (SREQ, TCA, Actor, Function) with highlighting, expand/collapse controls, uncovered SREQ toggle, and theme switching. Interactivity handled by `tree_func.js`. Test case keys link to the IOCore2 instance.
*   **`app/templates/index_tree_tin.html`**: Jinja2 template for the SREQ TIN-EP Viewer. Displays SREQs grouped by SI -> TIN/EP -> SREQ -> Test Case -> Actor. Features coverage indicators, search (SREQ, TCA), expand/collapse controls, and theme switching. Interactivity handled by `tree_tin.js`.
*   **`app/templates/nav_menu.html`**: Jinja2 template fragment for the main fixed navigation bar. Includes logo, classification banner, dropdown menus ("Get API", "View Coverage", "ASC"), direct links (System Monitor, Test Cases, Logout), and mobile menu toggle. Links trigger JavaScript functions.
*   **`app/templates/system_monitor.html`**: Jinja2 template for the System Health Monitor page. Displays metric cards and Chart.js line charts for historical CPU/Memory usage (Host and SQL). JavaScript fetches data periodically from `/api/remote_system_health` and updates the UI. Includes theme toggle.
*   **`app/templates/test_case_modal.html`**: HTML template fragment defining a large, scrollable Bootstrap Modal dialog for displaying test case details. Content (header, body, footer with Close/Print buttons) is loaded dynamically via JavaScript.
*   **`app/templates/test_case.html`**: Jinja2 template for the Test Cases listing page. Features a sortable, filterable (State, Pattern, Version), searchable, and paginated table. Rows are clickable to show details in the modal. Includes theme toggle. Logic handled by `test_case.js`.
*   **`app/templates/work_in_progress.html`**: Simple Jinja2 template displaying a "Work in Progress" message with an icon. Used as a placeholder page. Includes theme toggle.
*   **`app/templates/components/dataTable.html`**: Reusable Jinja2 template fragment for data tables. Includes CSS links (`dataTable.css`, `design-system.css`). Dynamically generates sortable headers based on `columns` variable. Includes table body placeholder, loading indicator, and standard pagination controls configured via passed variables (IDs).
*   **`app/templates/components/head_favicons.html`**: Jinja2 template fragment for `<head>`. Defines Content Security Policy (CSP) meta tag, links various favicon formats from `/static/favicon/`, and includes Font Awesome CSS.
*   **`app/templates/pages/affiliates_new.html`**: Jinja2 template for the Affiliates management page (ASC module). Uses `dataTable.html`. Includes filters (Name, Type, Environment) and an "Add Affiliate" button triggering a dialog. Logic handled by `affiliates_new.js`.
*   **`app/templates/pages/asc_kanban.html`**: Jinja2 template for the ASC Kanban Board page. Displays status columns ("Initial", "In Progress", etc.). Includes filters (Search, Affiliate, Service, Spiral). Cards are dynamically populated and made draggable via `kanban-board.js`.
*   **`app/templates/pages/ascs_new.html`**: Jinja2 template for the ASCs management page. Uses `dataTable.html`. Includes filters (Search, Affiliate, Service, Status, Environment). Displays ASC details (flag, status badges, progress bars, GP instances). Logic handled by `ascs_new.js`.
*   **`app/templates/pages/CI_new.html`**: Jinja2 template for the ASC Configuration Items management page. Uses `dataTable.html`. Includes filters (Name, custom searchable GP dropdown). Logic handled by `CI_new.js`.
*   **`app/templates/pages/gps_new.html`**: Jinja2 template for the ASC GPs management page. Uses `dataTable.html`. Includes a search filter. Logic handled by `gps_new.js`. Add button is disabled.
*   **`app/templates/pages/services_new.html`**: Jinja2 template for the ASC Services management page. Uses `dataTable.html`. Includes a search filter. Logic handled by `services_new.js`. Add button is disabled.
*   **`app/templates/pages/sps_new.html`**: Jinja2 template for the ASC Specific Products management page. Uses `dataTable.html`. Includes a search filter and "Add" button. Logic handled by `sps_new.js`.

## JavaScript Files (`.js`)

*   **`app/static/ASC/js/data-manager.js`**: Defines `DataManager` class for ASC module. Fetches/manages ASC, Affiliate, Service data from JSON. Provides filtering based on UI selections and methods to update ASC status (persisting via `/update_ascs` endpoint).
*   **`app/static/ASC/js/kanban-board.js`**: Defines `KanbanBoard` class for `asc_kanban.html`. Uses `DataManager` and `ThemeManager`. Renders ASC cards in status columns, handles drag-and-drop status updates (calling `dataManager.updateAscStatus`), manages filters, and provides UI feedback.
*   **`app/static/js/test_case.js`**: Client-side logic for `test_case.html`. Fetches test case/pattern data. Manages table display, filtering (State, Pattern, Version, Search), sorting, pagination. Handles opening/populating the details modal, including async fetching of actor names. Includes theme toggling and column resizing setup.
*   **`app/static/js/tree_func.js`**: Client-side interactivity for `index_tree_func.html`. Handles tree node expansion/collapse, multi-field search (SREQ, TCA, Actor, Function) with highlighting, toggling visibility of uncovered SREQs, and header/theme toggling. Uses debounce for search.
*   **`app/static/js/tree_ier.js`**: Client-side interactivity for `index_ier_tree.html`. Handles tree node expansion/collapse, search (IER, TCA), and header toggling. Initializes tree view state.
*   **`app/static/js/tree_tin.js`**: Client-side interactivity for `index_tree_tin.html`. Handles tree node expansion/collapse, search (SREQ, TCA), and header toggling. Initializes tree view state.
*   **`app/static/js/components/affiliateForm.js`**: Defines `AffiliateForm` class (reusable UI component). Creates/edits Affiliate records. Uses `FileUploader` (flag) and `MultiSelectDropdown` (environments). Handles validation and submission/deletion via callbacks.
*   **`app/static/js/components/columnResizer.js`**: Defines `ColumnResizer` class. Adds interactive resizing handles to table columns specified by a selector, handling mouse events for resizing.
*   **`app/static/js/components/configItemForm.js`**: Defines `ConfigItemForm` class (reusable UI component). Creates/edits ASC Configuration Items. Uses `MultiSelectDropdown` (Generic Products). Fetches GP data for dropdown options and ID/name mapping. Handles validation, uniqueness checks, and submission/deletion via callbacks.
*   **`app/static/js/components/dialogManager.js`**: Defines `DialogManager` class (reusable UI component). Creates/manages custom modal dialogs (independent of Bootstrap JS) with configurable size, title, content, and save/close callbacks. Handles backdrop, focus, ESC key closing, and injects necessary CSS.
*   **`app/static/js/components/fileUploader.js`**: Defines `FileUploader` class (reusable UI component). Handles file input, preview (images or filename), size validation, and clearing selection. Provides methods to get the selected file. Injects necessary CSS.
*   **`app/static/js/components/multiSelectDropdown.js`**: Defines `MultiSelectDropdown` class (reusable UI component). Allows selecting multiple items from predefined options, searching options, and adding new custom options. Displays selected items as tags/chips. Injects necessary CSS.
*   **`app/static/js/components/spForm.js`**: Defines `SPForm` class (reusable UI component). Creates/edits Specific Products. Includes fields for name, description, icon (using `FileUploader`), and manages a list of versions (add/remove badges). Handles validation and submission/deletion via callbacks.
*   **`app/static/js/components/tableCore.js`**: Defines `DataTable` class (reusable core framework). Manages data fetching, client-side filtering (with custom function support), sorting (with custom function support), pagination, and dynamic table rendering based on column configuration (including custom cell rendering). Includes optional lifecycle callbacks.
*   **`app/static/js/components/themeManager.js`**: Defines `ThemeManager` class. **Modified version:** Always enforces light mode by removing dark theme attributes (`data-theme`) and clearing the 'theme' preference from `localStorage`. Sets Bootstrap theme to light.
*   **`app/static/js/core/app.js`**: Main application initialization script. Uses module pattern, imports services (`ApiService`, `UiService`, `AuthService`). Exposes `IONIC` namespace globally. Initializes auth checks, mobile menu logic, and sets up global functions (e.g., `fetchIERReport`, `logout`) for backward compatibility with inline `onclick` handlers in HTML.
*   **`app/static/js/pages/affiliates_new.js`**: Logic for `affiliates_new.html`. Uses `DataTable`, `ColumnResizer`, `DialogManager`, `AffiliateForm`. Fetches data, configures table (custom rendering/filtering/sorting), handles add/edit/delete operations via dialog and API calls (including flag upload to `/api/affiliates/upload-flag`). Manages dynamic environment filter options. Includes notification display.
*   **`app/static/js/pages/ascs_new.js`**: Logic for `ascs_new.html`. Uses `DataTable`, `ColumnResizer`. Fetches auxiliary data (affiliates, services, GPs, SPs) for lookups. Configures table (custom rendering for flags, names, status badges, progress bars, GP instances), handles multi-dropdown filtering. Add button is disabled.
*   **`app/static/js/pages/CI_new.js`**: Logic for `CI_new.html`. Uses `DataTable`, `ColumnResizer`, `DialogManager`, `ConfigItemForm`. Fetches GP data first for filter dropdown and name mapping. Configures table (custom rendering/sorting for GPs). Handles add/edit/delete via dialog and API calls (`/api/config-items`), including client-side name uniqueness check. Manages custom searchable GP filter. Includes notification display.
*   **`app/static/js/pages/gps_new.js`**: Logic for `gps_new.html`. Uses `DataTable`, `ColumnResizer`. Fetches data, configures table (icon rendering), handles search filtering. Add button is disabled.
*   **`app/static/js/pages/services_new.js`**: Logic for `services_new.html`. Uses `DataTable`, `ColumnResizer`. Fetches GP data first for name mapping. Configures table (custom rendering/sorting for GPs and icons), handles search filtering. Add button is disabled.
*   **`app/static/js/pages/sps_new.js`**: Logic for `sps_new.html`. Uses `DataTable`, `ColumnResizer`, `DialogManager`, `SPForm`. Fetches data, configures table (version/icon rendering, custom sorting). Handles add/edit/delete via dialog and API calls (`/api/sps`, `/api/sps/upload-icon`), including client-side name uniqueness check. Includes notification display.
*   **`app/static/js/services/apiService.js`**: Defines `ApiService` class with static methods for calling backend API endpoints (fetch IER, SREQ, test cases, results, patterns, actors). Manages UI feedback (loaders, themed timer overlays) via `UiService`. Handles SREQ background processing polling (`/check_sreq_status`). Includes session expiration checks via `AuthService`.
*   **`app/static/js/services/authService.js`**: Defines `AuthService` class with static methods for client-side auth: `logout` (calls `/logout`), `checkAuthentication` (calls `/check_auth`), `handleSessionExpiration` (checks API responses for HTML/error messages indicating expiration), `checkSessionExpiredInHtml`, `initAuthChecks` (hides nav/redirects if not logged in).
*   **`app/static/js/services/uiService.js`**: Defines `UiService` class with static methods for UI feedback: `show/hideLoader` (toggles `#loader`), `showSuccessMessage` (displays temporary message in `#successMessages`), `create/removeTimerOverlay` (manages a full-screen overlay with timer/status for long operations). Theme functionality removed.

## JSON Files (`.json`)

*   **`app/static/ASC/data/affiliates.json`**: Array of affiliate objects (nation/org) with `name`, `type`, `environments` (array), `flagPath`, `id`. Used for Affiliates page and lookups.
*   **`app/static/ASC/data/ascs.json`**: Array of ASC (Affiliate Service Configuration) objects linking `affiliateId`, `serviceId`, `spiral`, `environment`. Includes `status`, `progress`, and nested `gpInstances` (linking GPs to SPs with versions and labels). Main data for ASCs page and Kanban.
*   **`app/static/ASC/data/configItem.json`**: Array of configuration item objects with `Name`, associated `GenericProducts` (GP IDs array), `DefaultValue`, `HelpText`, `ConfigurationAnswerType`, `AnswerContent`. Data source for CI page.
*   **`app/static/ASC/data/gps.json`**: Array of Generic Product (GP) objects with `name`, `description`, `iconPath`, `id`. Used for GPs page and lookups (CI, ASCs, Services).
*   **`app/static/ASC/data/services.json`**: Array of Service objects with `name`, `spiral`, associated `gps` (GP IDs array), optional `iconPath`/`functionalDiagramPath`, `id`. Used for Services page and lookups (ASCs).
*   **`app/static/ASC/data/sps.json`**: Array of Specific Product (SP) objects with `name`, `description`, `versions` (array), optional `iconPath`, `id`. Used for SPs page and lookups (ASCs).
*   **`data/actors.json`**: (Inferred due to size) Large array of Actor objects, likely with `id` and `name`. Used for mapping IDs to names in test case details via `/api/actor/<actor_id>` endpoint.
*   **`data/IER copy.json`**: Copy/snapshot of IER coverage data. Array linking PI, IER, IDP/TIN, and Test Case details (`testCaseId`, `testCaseKey`, etc.). Includes entries with null test cases.
*   **`data/IER.json`**: Primary/live IER coverage data fetched from API. Same structure as the copy. Used for IER analysis and tree view. Overwritten on fetch.
*   **`data/pattern.json`**: Array of Test Case Pattern objects defining abstract interaction scenarios with roles (`patternRoles` array with id, name, graph data) and relationships (`patternRoleRelations` array linking roles). Used by Test Case page.
*   **`data/SP5-Functional.json`**: Array mapping SREQs (`sreqNumber`, `sreqName`) to SI Name (`siName`) and Functional Area Name (`funName`) for the SP5 spiral. Used for functional tree view grouping.
*   **`data/SREQ.json`**: (Inferred due to size) Primary/live SREQ coverage data. Large array linking SREQ to Test Case, including hierarchy (SI, TIN, EP, Function, Actor). Used for SREQ analysis and tree views. Overwritten on fetch. Includes entries with null `testCaseId`.
*   **`data/test_cases.json`**: (Inferred due to size) Primary/live Test Case data. Large array of test case objects with `key`, `name`, `state`, `version` (object), `patternId`, details (`purpose`, `steps`, etc.), `testCaseActorRoles`. Used for Test Cases page. Overwritten on fetch.
*   **`data/test_results.json`**: (Inferred due to size) Primary/live Test Result data. Large array of test result objects, likely including test case ID, outcome, timestamps, etc. Not directly used by reviewed UI components. Overwritten on fetch.

## Excel Files (`.xlsx`)

*Note: Content could not be read directly.*

*   **`app/static/ASC/data/AssetTypes.xlsx`**: (Inferred) Likely defines different types or categories for assets within the ASC module (e.g., configuration items, services).
*   **`app/static/ASC/data/ProductTypes.xlsx`**: (Inferred) Likely defines different types or categories for products (GPs/SPs) within the ASC module.
*   **`app/static/ASC/data/ServiceFunctionConfigurationQuestions.xlsx`**: (Inferred) Likely contains structured questions related to configuring service functions, possibly mapping services/functions to configuration items.
*   **`data/SP5-Functional.xlsx`**: (Inferred) Likely the Excel source file used to generate `data/SP5-Functional.json`, mapping SREQs to functional areas for the SP5 spiral.

## CSS Files (`.css`)

*   **`app/static/ASC/css/kanban-board.css`**: Styles for the ASC Kanban Board page (`asc_kanban.html`). Defines grid layout, column/card appearance (status colors), progress indicators, filters, drag-and-drop feedback, and dark mode adjustments.
*   **`app/static/css/test_case.css`**: Styles for the Test Cases page (`test_case.html`) and potentially shared by ASC pages. Defines theming variables (light/dark), layout, table styling (sticky header, sorting indicators), filter/search controls, status tags, version badges, modal content styling, and print-specific styles for the modal.
*   **`app/static/css/components/dataTable.css`**: Shared styles for the `dataTable.html` component. Includes layout for table container (scrolling, height), sticky headers, sort icons, filter/search controls, pagination controls, column resizing handles, icon/flag styling, table-specific column widths, and dark mode adjustments.
*   **`app/static/css/components/design-system.css`**: Foundational design system using CSS variables. Defines color palettes (light/dark), typography scale, spacing system, borders/shadows, transitions, z-index layers, and basic utility classes.
*   **`app/static/css/components/sp-styles.css`**: Styles primarily for the Specific Products (SP) page (`sps_new.html`). Styles SP icons, version badges in the SP form, and includes some common/shared styles (theme variables, body margin, add button, theme toggle, notifications, dialog form elements).
